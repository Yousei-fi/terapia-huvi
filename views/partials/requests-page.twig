{% set lang = lang ?? language ?? 'fi' %}
{% set slug = slug ?? 'requests-page' %}
{% set requests_defaults = {
  'fi': {
    'eyebrow': 'Tietopyynnöt',
    'title': 'Tehdyt tietopyynnöt ja dokumentoitu tieto',
    'copy': '<p>Julkaisemme viranomaisille tekemämme, julkisuuslakiin perustuvat tietopyynnöt ja niihin saadut vastaukset, jotta tieto olisi avoimesti hyödynnettävissä. Päivitämme listaa aina uusien vastausten valmistuessa.</p>',
    'footer': '<p>Ajantasaiset tietopyynnöt ja vastaukset julkaistaan tietopyynto.fi-palvelussa. Koko listan saat pyytämällä meiltä: <a href="mailto:hpp@hppry.fi" class="text-brand-orange hover:text-brand-orange/80">hpp@hppry.fi</a>.</p>'
  },
  'en': {
    'eyebrow': 'Information requests',
    'title': 'Published requests and documented knowledge',
    'copy': '<p>We publish the freedom-of-information requests we file with authorities and the responses we receive, keeping knowledge open for everyone. The archive grows as new replies arrive.</p>',
    'footer': '<p>Current requests and responses appear on tietopyynto.fi. For the full archive, drop us a line: <a href="mailto:hpp@hppry.fi" class="text-brand-orange hover:text-brand-orange/80">hpp@hppry.fi</a>.</p>'
  }
} %}
{% set requests_data = requests_defaults[lang] ?? requests_defaults.fi %}
{% set cards_default = lang == 'fi'
  ? [
    {
      'title': 'Seuraukset epäillylle ja tuomitulle',
      'copy': 'Turvallisuusselvitysten, rikostaustaotteiden ja rekisterimerkintöjen vaikutukset käyttö- ja huumausainerikoksissa.',
      'items': [
        'Huumausaineen käyttörikos turvallisuusselvityksessä (Suojelupoliisi, 2017)',
        'Huumausaineen käyttörikos rikostaustaotteessa (Oikeusrekisterikeskus, 2017)',
        'Merkinnät poliisin rekistereissä ja lastensuojeluilmoitukset (Poliisihallitus, 2020)'
      ]
    },
    {
      'title': 'Ajoterveys ja turvallisuus',
      'copy': 'Päihteiden vaikutus ajokuntoon, ajokorttiluvat ja poliisin velvollisuudet liikenneturvallisuuden varmistamisessa.',
      'items': [
        'Päihteiden vaikutus ajokuntoon (THL, 2018)',
        'Ajokieltojen perusteet ja palauttaminen (Poliisihallitus, 2018–2019)',
        'Ajoterveyden lausuntomääräykset (Poliisihallitus, 2019)'
      ]
    },
    {
      'title': 'Rikoksen vakavuus ja ohjeistukset',
      'copy': 'Poliisin ja syyttäjän ohjeet, prioriteettilistat sekä oikeuskäytäntö koskien huumausaineiden vaarallisuutta.',
      'items': [
        'Poliisin ohjeet huumausaineasioissa (Poliisihallitus, 2018)',
        'Huumausaineiden vaarallisuutta koskevat lausunnot (KRP, THL, Fimea, 2017)',
        'Prioriteettilistat rikosnimikkeistä (Poliisihallitus, 2019)'
      ]
    },
    {
      'title': 'Tilastot ja selvitykset',
      'copy': 'Tilastokeskuksen, poliisin ja tullin aineistot, jotka valottavat päihdepolitiikan vaikutuksia.',
      'items': [
        'Käyttörikosten määrät ja tekijät (Poliisiammattikorkeakoulu, 2018)',
        'Huumetakavarikot aineittain (KRP, 2019)',
        'Liikennejuopumustilastot (KRP, 2015–2020)'
      ]
    }
  ]
  : [
    {
      'title': 'Impacts on suspects and convicts',
      'copy': 'Security clearances, criminal records, and database entries linked to use and drug offences.',
      'items': [
        'Drug use offences in security clearances (Finnish Security Intelligence Service, 2017)',
        'Drug use offences on criminal record extracts (Legal Register Centre, 2017)',
        'Police registers and child welfare notifications (National Police Board, 2020)'
      ]
    },
    {
      'title': 'Driving fitness and safety',
      'copy': 'How substances affect driving, licensing decisions, and police obligations in traffic safety.',
      'items': [
        'Impact of substances on driving (THL, 2018)',
        'Grounds and reinstatement of driving bans (National Police Board, 2018–2019)',
        'Guidelines for medical statements on driving fitness (National Police Board, 2019)'
      ]
    },
    {
      'title': 'Severity and prosecutorial guidance',
      'copy': 'Police and prosecutor guidelines, priority lists, and case law on drug offence seriousness.',
      'items': [
        'Police guidelines for drug-related cases (National Police Board, 2018)',
        'Expert statements on drug harmfulness (NBI, THL, Fimea, 2017)',
        'Priority lists of offence categories (National Police Board, 2019)'
      ]
    },
    {
      'title': 'Statistics and assessments',
      'copy': 'Datasets from Statistics Finland, police, and customs revealing policy impacts and needs.',
      'items': [
        'Quantities and profiles of use offences (Police University College, 2018)',
        'Drug seizures by substance (NBI, 2019)',
        'Traffic intoxication statistics (NBI, 2015–2020)'
      ]
    }
  ]
%}
{% set entries_from_meta = page_field_pairs(slug, 'entries_' ~ lang, []) %}
{% set entries = [] %}
{% for idx, card in cards_default %}
  {% set meta_entry = entries_from_meta[idx] ?? {} %}
  {% set items = page_field_list(slug, 'entry_' ~ (idx + 1) ~ '_items_' ~ lang, card.items ?? []) %}
  {% set entries = entries|merge([{
    'title': meta_entry.title|default(card.title),
    'copy': meta_entry.copy|default(card.copy),
    'items': items
  }]) %}
{% endfor %}

<section class="bg-white py-16 md:py-20">
  <div class="mx-auto max-w-6xl px-4">
    <span class="eyebrow">{{ page_field(slug, 'eyebrow_' ~ lang, requests_data.eyebrow) }}</span>
    <h1 class="section-heading">{{ page_field(slug, 'title_' ~ lang, requests_data.title) }}</h1>
    <div class="prose max-w-none text-slate-700">
      {{ page_field(slug, 'content_' ~ lang, requests_data.copy)|raw }}
    </div>
    <div class="mt-10 grid gap-6 md:grid-cols-2">
      {% for entry in entries %}
        <article class="rounded-3xl border border-brand-orange/20 bg-brand-cloud p-6 shadow-sm shadow-brand-orange/10">
          <h2 class="text-lg font-semibold text-slate-900">{{ entry.title }}</h2>
          <p class="mt-3 text-sm text-slate-600">{{ entry.copy }}</p>
          {% if entry.items %}
            <ul class="mt-4 space-y-2 text-sm text-slate-600">
              {% for item in entry.items %}
                <li>{{ item }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        </article>
      {% endfor %}
    </div>
    <div class="mt-10 text-sm text-slate-600">
      {{ page_field(slug, 'footer_text_' ~ lang, requests_data.footer)|raw }}
    </div>
  </div>
</section>

